namespace = cbshing_origins_habitat_start
# file modifies start planets to be a Habitat Start
# by cbshing

# Triggers when the game starts

### Change homeworld to Habitat if have Habitat Civics on Game Start
country_event = {
	id = cbshing_origins_habitat_start.1
	hide_window = yes
	is_triggered_only = yes

	trigger = { 
		OR = {
			is_cbshing_habitat_country = yes 
			is_cbshing_addon_habitat_country = yes 
			NOT = { has_country_flag = origins_habitat_created }
		}
	}

	immediate = {
		#find secondary_species
		random_owned_pop = {
			limit = { NOT = { is_exact_same_species = owner_species } }
			save_event_target_as = habitat_secondary_species
		}
		#find homeworld and create habitat
		origins_spawn_habitat_over_capital = yes
		set_country_flag = origins_habitat_created
		
		#find habitat and populate
		random_planet_within_border ={
			limit = { is_planet_class = pc_habitat }
			save_event_target_as = habitat_capital
			origins_reset_start_buildings_and_blockers_habitat = yes
			set_owner = ROOT
			#Create secondary species pops
			#This can be robots or secondary species
			if = { 
				limit = { ROOT = { is_cbshing_habitat_country_has_any_secondary_species = yes } }
				every_tile = {
					limit = { 
						has_building = building_hab_astro_mining_facility 
						has_pop = no 
						has_blocker = no
					}
					create_pop = { 
						species = event_target:habitat_secondary_species
						ethos = random
					}
				}
			}
			#For organic secondary species like Syncretic or Codominant
			if = { 
				limit = { ROOT = { is_cbshing_habitat_country_has_organic_secondary_species = yes } }
				every_tile = {
					limit = { 
						has_building = building_hab_agri_bay 
						has_pop = no 
						has_blocker = no
					}
					create_pop = { 
						species = event_target:habitat_secondary_species
						ethos = random
					}
				}
			}
			#All other pop types
			every_tile = {
				limit = { has_building = yes has_pop = no has_blocker = no}
				create_pop = { 
					species = owner_species
					ethos = random
				}
			}	
			set_capital = yes
		}
		
		#change species to be voidborne species (habitat preference)
		if = { 
			limit = { is_cbshing_voidborne_country = yes }
			origins_give_species_habitat_preference = yes
		}
		
		# Nuke other colonies gained from advanced empire, etc
		origins_nuke_all_colonies = yes
		
		#Nuke old homeworld planet
		if = { 
			limit = { is_cbshing_habitat_nuke_old_homeworld_country = yes }
			random_owned_planet ={
				limit = { is_same_value = event_target:habitat_capital_planet }
				random_list = {
					18 = { change_pc = pc_barren }
					18 = { change_pc = pc_molten }
					18 = { change_pc = pc_barren_cold }
					18 = { change_pc = pc_toxic }
					18 = { change_pc = pc_frozen }
					5 = { change_pc = pc_broken }
					5 = { change_pc = pc_shattered }
				}
				if = {
					limit = { 
						NOR = {
							is_planet_class = pc_broken
							is_planet_class = pc_shattered
						}
					}
					add_modifier = { modifier = "terraforming_candidate" days = -1 }
				}
			}
		}
		set_country_flag = already_built_habitat
	}
}

# Change homeworld to habitats
# Used after game start to allow for localisation text to work, but accommodate ascension perks
country_event = {
	id = cbshing_origins_habitat_start.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_cbshing_voidborne_country = yes }
			origins_make_current_capital_homeworld = yes	
		}
	}
}