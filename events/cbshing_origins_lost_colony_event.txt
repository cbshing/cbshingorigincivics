namespace = cbshing_origins_lost_colony_event
# by cbshing

@tier1influencecontact = 7
@tier1influencecontactxenophile = 8
@tier1influencecontactmin = 20
@tier1influencecontactmax = 80

@tier2influencecontact = 10
@tier2influencecontactxenophile = 12
@tier2influencecontactmin = 40
@tier2influencecontactmax = 100

@tier1materialreward = 6
@tier1materialmin = 100
@tier1materialmax = 500
@tier2materialreward = 12
@tier2materialmin = 150
@tier2materialmax = 1000
@tier3materialreward = 18
@tier3materialmin = 250
@tier3materialmax = 1500
@tier4materialreward = 24
@tier4materialmin = 350
@tier4materialmax = 2000
@tier5materialreward = 48
@tier5materialmin = 700
@tier5materialmax = 4000

@tier1influencereward = 6
@tier1influencemin = 40
@tier1influencemax = 100
@tier2influencereward = 12
@tier2influencemin = 80
@tier2influencemax = 175
@tier3influencereward = 18
@tier3influencemin = 125
@tier3influencemax = 250
@tier4influencereward = 24
@tier4influencemin = 150
@tier4influencemax = 300
@tier5influencereward = 36
@tier5influencemin = 250
@tier5influencemax = 500
@tier6influencereward = 48
@tier6influencemin = 300
@tier6influencemax = 600

@tier1unityreward = 6
@tier1unitymin = 100
@tier1unitymax = 500
@tier2unityreward = 12
@tier2unitymin = 150
@tier2unitymax = 1000
@tier3unityreward = 18
@tier3unitymin = 250
@tier3unitymax = 1500
@tier4unityreward = 24
@tier4unitymin = 350
@tier4unitymax = 2000
@tier5unityreward = 48
@tier5unitymin = 700
@tier5unitymax = 4000

@tier1researchreward = 6
@tier1researchmin = 60
@tier1researchmax = 150
@tier2researchreward = 12
@tier2researchmin = 90
@tier2researchmax = 250
@tier3researchreward = 18
@tier3researchmin = 120
@tier3researchmax = 350
@tier4researchreward = 24
@tier4researchmin = 150
@tier4researchmax = 500
@tier5researchreward = 48
@tier5researchmin = 300
@tier5researchmax = 1000

# Below is to be deleted
event = {
	id = cbshing_origins_lost_colony_event.0
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		years_passed > 100
		#any_country = {
		#	OR = {
		#		is_cbshing_lost_colony_events_country = yes 
		#		has_country_flag = colony_home_empire
		#	}
		#	has_country_flag = lost_breathren_found
		#}
	}

	immediate = {
		random_country = {
			limit = { 
				OR = {
					is_cbshing_lost_colony_events_country = yes 
					has_country_flag = colony_home_empire
				}
				has_country_flag = lost_breathren_found
			}
			if = { limit = { is_cbshing_lost_colony_events_country = yes  }
				country_event = { id = cbshing_origins_lost_colony_event.2 }
			}
			if = { limit = { has_country_flag = colony_home_empire  }
				country_event = { id = cbshing_origins_lost_colony_event.4 }
			}
		}
	}
}

#Lost Colony Found Homeworld
country_event = {
	id = cbshing_origins_lost_colony_event.1
	title = cbshing_origins_lost_colony_event.1.name
	desc = cbshing_origins_lost_colony_event.1.desc
	
	picture = GFX_evt_news_room
	show_sound = event_celebration
	location = FROM

	is_triggered_only = yes

	trigger = {
		is_ai = no
		is_cbshing_lost_colony_events_country = yes
		NOT = { has_country_flag = lost_colony_home_found }
		NOT = { has_ethic = ethic_gestalt_consciousness }
	}

	immediate = {
		set_country_flag = lost_colony_home_found
		#country_event = { id = cbshing_origins_lost_colony_event.2 days = 21600 }
	}

	option = {
		name = cbshing_origins_lost_colony_event.1.a
		add_monthly_resource_mult = {
			resource = influence
			value = @tier2influencereward
			min = @tier2influencemin
			max = @tier2influencemax
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
		add_modifier = { modifier = cbshing_origins_found_homeworld days = 3600 }
	}
}

#Lost Colony Mid-Game Bonus
country_event = {
	id = cbshing_origins_lost_colony_event.2
	title = cbshing_origins_lost_colony_event.2.name
	desc = cbshing_origins_lost_colony_event.2.desc
	
	picture = GFX_evt_throne_room
	show_sound = event_factions
	location = FROM

	is_triggered_only = yes

	trigger = {
		years_passed > 100
		is_ai = no
		is_cbshing_lost_colony_events_country = yes
		has_country_flag = lost_colony_home_found
		NOT = { has_country_flag = lost_colony_decision_made }
	}

	immediate = {
		set_country_flag = lost_colony_decision_made
	}

	option = {
		name = cbshing_origins_lost_colony_event.2.a
		add_modifier = { modifier = cbshing_origins_dominate_homeworld }
		trigger = {
			NOT = { has_ethic = ethic_fanatic_pacifist }
			NOT = { has_ethic = ethic_fanatic_egalitarian }
		}
	}
	option = {
		name = cbshing_origins_lost_colony_event.2.b
		add_modifier = { modifier = cbshing_origins_unite_homeworld }
		trigger = {
			NOT = { has_ethic = ethic_fanatic_authoritarian }
		}
	}
}

#Same Species Found
country_event = {
	id = cbshing_origins_lost_colony_event.3
	title = cbshing_origins_lost_colony_event.3.name
	desc = cbshing_origins_lost_colony_event.3.desc
	
	picture = GFX_evt_news_room
	show_sound = event_celebration
	location = FROM

	is_triggered_only = yes

	trigger = {
		is_ai = no
		OR = {
			is_cbshing_lost_colony_events_country = yes
			has_country_flag = colony_home_empire
		}
		#NOT = { has_country_flag = lost_breathren_found }
		NOT = { has_ethic = ethic_gestalt_consciousness }
	}

	immediate = {
		set_country_flag = lost_breathren_found
		if = { 
			limit = { has_country_flag = colony_home_empire }
			#country_event = { id = cbshing_origins_lost_colony_event.4 days = 21600 }
		}
	}

	option = {
		name = cbshing_origins_lost_colony_event.1.a
		add_monthly_resource_mult = {
			resource = influence
			value = @tier2influencereward
			min = @tier2influencemin
			max = @tier2influencemax
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
		add_modifier = { modifier = cbshing_origins_found_breathen days = 3600 }
	}
}

#Homeworld Mid-Game Bonus
country_event = {
	id = cbshing_origins_lost_colony_event.4
	title = cbshing_origins_lost_colony_event.4.name
	desc = cbshing_origins_lost_colony_event.4.desc
	
	picture = GFX_evt_throne_room
	show_sound = event_factions
	location = FROM

	is_triggered_only = yes

	trigger = {
		years_passed > 100
		is_ai = no
		is_cbshing_lost_colony_events_country = no
		has_country_flag = colony_home_empire
		has_country_flag = lost_breathren_found
		NOT = { has_country_flag = lost_colony_decision_made }
	}

	immediate = {
		set_country_flag = lost_colony_decision_made
	}

	option = {
		name = cbshing_origins_lost_colony_event.4.a
		add_modifier = { modifier = cbshing_origins_dominate_colonies }
		trigger = {
			NOT = { has_ethic = ethic_fanatic_pacifist }
			NOT = { has_ethic = ethic_fanatic_egalitarian }
		}
	}
	option = {
		name = cbshing_origins_lost_colony_event.4.b
		add_modifier = { modifier = cbshing_origins_unite_colonies }
		trigger = {
			NOT = { has_ethic = ethic_fanatic_authoritarian }
		}
	}
}

#Found Homeworld (if owned by country not "home" empire)
# Scope = Ship
# From = System
# FromFrom = Country
# also owner, obv
ship_event = {
	id = cbshing_origins_lost_colony_event.5
	title = cbshing_origins_lost_colony_event.5.name
	desc = cbshing_origins_lost_colony_event.5.desc
	
	picture = GFX_evt_throne_room
	show_sound = event_celebration
	location = FROM

	is_triggered_only = yes

	trigger = {
		from = { 
			#owner = { has_country_flag = colony_home_empire }
			any_planet = { is_planet = root.owner.home_planet }
		}
		owner = { 
			is_ai = no
			is_cbshing_lost_colony_events_country = yes
			NOT = { has_country_flag = lost_colony_home_found }
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
	}

	immediate = {
		owner = { set_country_flag = lost_colony_home_found	}
	}

	option = {
		name = cbshing_origins_lost_colony_event.5.a
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier2influencereward
				min = @tier2influencemin
				max = @tier2influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
			add_modifier = { modifier = cbshing_origins_found_homeworld days = 3600 }
		}
	}
}

# First Contact Empires
# Establish comms when finding a known species (lost colony)
country_event = {
	id = cbshing_origins_lost_colony_event.10
	title = cbshing_origins_lost_colony_event.41.name
	desc = cbshing_origins_lost_colony_event.41.desc
	picture = GFX_evt_star_chart
	location = FROMFROMFROM
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = default
		exists = capital_scope
		NOT = { has_country_flag = day_0 }
		from = { NOT = { has_country_flag = day_0 } }
		OR = {
			has_country_flag = colony_home_empire
			is_cbshing_lost_colony_events_country = yes
		}
		from = {
			is_country_type = default
			OR = {
				has_country_flag = colony_home_empire
				is_cbshing_lost_colony_events_country = yes
			}
		}
		NOT = { has_country_flag = has_communications@from }
		is_same_species = FROM.owner_species
	}

	immediate = {
		FROM = { save_event_target_as = contact_empire }
		THIS = { save_event_target_as = from_contact_empire }
		event_target:contact_empire = {
			hidden_effect = {
				establish_contact = {
					who = from_contact_empire
					location = from_contact_empire.capital_scope
				}
				#establish_communications = from_contact_empire
				establish_communications_no_message = from_contact_empire
				#country_event = { id = cbshing_origins_lost_colony_event.12 days  = 1 }
				add_opinion_modifier = {
					who = from_contact_empire
					modifier = cbshing_origins_lost_breathren
				}
				#if = {
				#	limit = {
				#		is_country_type = default
				#		is_hostile = from_contact_empire
				#	}
				#	country_event = { id = action.7 }
				#}
				remove_opinion_modifier = {
					who = from_contact_empire
					modifier = opinion_new_contact
				}
			}
		}
	}
	
	option = {
		name = cbshing_origins_lost_colony_event.41.a
		hidden_effect = {
			establish_contact = {
				who = event_target:contact_empire
				location = event_target:contact_empire.capital_scope
			}
			#establish_communications = event_target:contact_empire
			establish_communications_no_message = event_target:contact_empire
			country_event = { id = cbshing_origins_lost_colony_event.11 days  = 1 }
			add_opinion_modifier = {
				who = event_target:contact_empire
				modifier = cbshing_origins_lost_breathren
			}
			#if = {
			#	limit = {
			#		is_country_type = default
			#		is_hostile =event_target:contact_empire
			#	}
			#	country_event = { id = action.7 }
			#}
			remove_opinion_modifier = {
				who = event_target:contact_empire
				modifier = opinion_new_contact
			}
		}
	}
}

country_event = {
	id = cbshing_origins_lost_colony_event.11
	title = cbshing_origins_lost_colony_event.11.name
	message_desc = cbshing_origins_lost_colony_event.11.message
	location = event_target:contact_empire.capital_scope
	
	picture_event_data = {
		portrait = event_target:contact_empire
		planet_background = event_target:contact_empire
		graphical_culture = event_target:contact_empire
		city_level = event_target:contact_empire
		room = event_target:contact_empire.ruler
	}
	
	### Establish comms when finding a same species
	desc = {
		text = cbshing_origins_lost_colony_event.11.desc
		trigger = {
			is_same_species = event_target:contact_empire
		}
	}
	
	diplomatic = yes
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		event_target:contact_empire = {
			is_country_type = default
			is_same_species = event_target:contact_empire
		}
	}
	
	immediate = {
		#country_event = { id = advisor.27 }
		#country_event = { id = advisor.28 }
		#country_event = { id = anomaly.4016 }
		event_target:contact_empire = {
			save_event_target_as = contact_speaker
		}
	}
	
	option = {
		name = cbshing_origins_lost_colony_event.11.a
		hidden_effect = {
			if = {
				limit = { event_target:contact_empire = { has_country_flag = colony_home_empire } }
				country_event = { id = cbshing_origins_lost_colony_event.1 days = 10 }
			}
			if = {
				limit = { event_target:contact_empire = { is_cbshing_lost_colony_events_country = yes } }
				country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
			}
		}
	}
}

country_event = {
	id = cbshing_origins_lost_colony_event.12
	title = cbshing_origins_lost_colony_event.11.name
	message_desc = cbshing_origins_lost_colony_event.11.message
	location = event_target:contact_empire.capital_scope
	
	picture_event_data = {
		portrait = event_target:contact_empire
		planet_background = event_target:contact_empire
		graphical_culture = event_target:contact_empire
		city_level = event_target:contact_empire
		room = event_target:contact_empire.ruler
	}
	
	### Establish comms when finding a same species
	desc = {
		text = cbshing_origins_lost_colony_event.11.desc
		trigger = {
			is_same_species = event_target:contact_empire
		}
	}
	
	diplomatic = yes
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		event_target:contact_empire = {
			is_country_type = default
			is_same_species = event_target:contact_empire
		}
	}
	
	immediate = {
		#country_event = { id = advisor.27 }
		#country_event = { id = advisor.28 }
		#country_event = { id = anomaly.4016 }
		event_target:contact_empire = {
			save_event_target_as = contact_speaker
		}
	}
	
	option = {
		name = cbshing_origins_lost_colony_event.11.a
		hidden_effect = {
			if = {
				limit = { event_target:contact_empire = { has_country_flag = colony_home_empire } }
				country_event = { id = cbshing_origins_lost_colony_event.1 days = 10 }
			}
			if = {
				limit = { event_target:contact_empire = { is_cbshing_lost_colony_events_country = yes } }
				country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
			}
		}
	}
}

# Star chart trade check
planet_event = {
	id = cbshing_origins_lost_colony_event.259
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { exists = fromfrom }
		exists = root.owner
	}

	immediate = {
		root.owner = { save_event_target_as = contact_empire_traded }
		from = {
			country_event = { id = cbshing_origins_lost_colony_event.13 }
			#country_event = { id = cbshing_origins_lost_colony_event.260 }
		}
	}
}

# First Contact Empires
# Establish comms when finding a known species (lost colony)
country_event = {
	id = cbshing_origins_lost_colony_event.13
	title = cbshing_origins_lost_colony_event.13.name
	desc = cbshing_origins_lost_colony_event.13.desc
	picture = GFX_evt_star_chart
	location = FROM.capital_scope
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = default
		exists = capital_scope
		NOT = { has_country_flag = day_0 }
		event_target:contact_empire_traded = { NOT = { has_country_flag = day_0 } }
		OR = {
			has_country_flag = colony_home_empire
			is_cbshing_lost_colony_events_country = yes
		}
		event_target:contact_empire_traded = {
			is_country_type = default
			OR = {
				has_country_flag = colony_home_empire
				is_cbshing_lost_colony_events_country = yes
			}
		}
		NOT = { has_country_flag = has_communications@event_target:contact_empire_traded }
		is_same_species = event_target:contact_empire_traded.owner_species
	}

	immediate = {
		THIS = { save_event_target_as = from_contact_empire }
		event_target:contact_empire = {
			hidden_effect = {
				establish_contact = {
					who = from_contact_empire
					location = from_contact_empire.capital_scope
				}
				establish_communications_no_message = from_contact_empire
				add_opinion_modifier = {
					who = from_contact_empire
					modifier = cbshing_origins_lost_breathren
				}
				#if = {
				#	limit = {
				#		is_country_type = default
				#		is_hostile = from_contact_empire
				#	}
				#	country_event = { id = action.7 }
				#}
				remove_opinion_modifier = {
					who = from_contact_empire
					modifier = opinion_new_contact
				}
			}
		}
	}
	
	option = {
		name = cbshing_origins_lost_colony_event.41.a
		hidden_effect = {
			establish_contact = {
				who = event_target:contact_empire_traded
				location = event_target:contact_empire_traded.capital_scope
			}
			#establish_communications = event_target:contact_empire_traded
			establish_communications_no_message = event_target:contact_empire_traded
			country_event = { id = cbshing_origins_lost_colony_event.11 days  = 1 }
			add_opinion_modifier = {
				who = event_target:contact_empire_traded
				modifier = cbshing_origins_lost_breathren
			}
			if = {
				limit = {
					is_country_type = default
					is_hostile =event_target:contact_empire_traded
				}
				country_event = { id = action.7 }
			}
			remove_opinion_modifier = {
				who = event_target:contact_empire_traded
				modifier = opinion_new_contact
			}
		}
	}
}

# Pre-establish comms when finding the same species
fleet_event = {
	id = cbshing_origins_lost_colony_event.41
	title = cbshing_origins_lost_colony_event.41.name
	desc = cbshing_origins_lost_colony_event.41.desc
	
	picture = GFX_evt_star_chart
	show_sound = event_ship_bridge
	location = FROM

	is_triggered_only = yes

	trigger = {
		owner = { 
			OR = {
				AND = {
					is_country_type = default
					is_cbshing_lost_colony_events_country = yes
				}
				AND = {
					is_country_type = default
					has_country_flag = colony_home_empire
				}
			}
			#owner_species = { save_event_target_as = lost_home_species }
		}
		from = {
			OR = {
				AND = {
					exists = space_owner
					space_owner = {
						#is_same_species = event_target:lost_home_species
						is_same_species = root.owner.owner_species
						OR = {
							is_cbshing_lost_colony_events_country = yes
							has_country_flag = colony_home_empire
						}
						NOT = { has_communications = root.owner }
					}				
				}
				#any_neighbor_system = {
				#	exists = space_owner
				#	space_owner = {
				#		#is_same_species = event_target:lost_home_species
				#		is_same_species = root.owner.owner_species
				#		OR = {
				#			is_cbshing_lost_colony_events_country = yes
				#			has_country_flag = colony_home_empire
				#		}
				#		NOT = { has_communications = root.owner }
				#	}					
				#}
			}
		}
	}

	immediate = {
		owner = { owner_species = { save_event_target_as = lost_home_species } }
		owner = { save_event_target_as = from_contact_empire }
		from = {
			if = {
				limit = {
					exists = space_owner
					space_owner = {
						#is_same_species = event_target:lost_home_species
						is_same_species = root.owner.owner_species
						OR = {
							is_cbshing_lost_colony_events_country = yes
							has_country_flag = colony_home_empire
						}
						NOT = { has_communications = root.owner }
					}				
				}
				space_owner = {
					save_event_target_as = contact_empire
				}	
				#else = {
				#	random_neighbor_system = {
				#		limit = {
				#			exists = space_owner
				#			space_owner = {
				#				#is_same_species = event_target:lost_home_species
				#				is_same_species = root.owner.owner_species
				#				OR = {
				#					is_cbshing_lost_colony_events_country = yes
				#					has_country_flag = colony_home_empire
				#				}
				#				NOT = { has_communications = root.owner }
				#			}				
				#		}
				#		space_owner = {
				#			save_event_target_as = contact_empire
				#		}						
				#	}				
				#}
			}
		}
	}
		
	option = {
		name = cbshing_origins_lost_colony_event.41.a
		hidden_effect = {
			owner = {
				establish_contact = {
					who = event_target:contact_empire
					location = event_target:contact_empire.capital_scope
				}
				establish_communications = event_target:contact_empire
				#country_event = { id = action.100 }
				add_opinion_modifier = {
					who = event_target:contact_empire
					modifier = cbshing_origins_lost_breathren
				}
				if = {
					limit = {
						is_country_type = default
						is_hostile = event_target:contact_empire
					}
					country_event = { id = action.7 }
				}
				remove_opinion_modifier = {
					who = event_target:contact_empire
					modifier = opinion_new_contact
				}
				#if = {
				#	limit = { event_target:contact_empire = { has_country_flag = colony_home_empire } }
					#country_event = { id = cbshing_origins_lost_colony_event.1 days = 10 }
				#}
				#if = {
				#	limit = { event_target:contact_empire = { is_cbshing_lost_colony_events_country = yes } }
					#country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
				#}
			}
			event_target:contact_empire = {
				establish_contact = {
					who = event_target:from_contact_empire
					location = event_target:from_contact_empire.capital_scope
				}
				establish_communications = event_target:from_contact_empire
				add_opinion_modifier = {
					who = event_target:from_contact_empire
					modifier = cbshing_origins_lost_breathren
				}
				if = {
					limit = {
						is_country_type = default
						is_hostile = event_target:from_contact_empire
					}
					country_event = { id = action.7 }
				}
				remove_opinion_modifier = {
					who = event_target:from_contact_empire
					modifier = opinion_new_contact
				}
				#if = {
				#	limit = { 
				#		OR = { 
				#			has_country_flag = colony_home_empire
				#			is_cbshing_lost_colony_events_country = yes 
				#		}
				#	}					
				#	#country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
				#}
			}
		}
	}
}

# Post establish comms
country_event = {
	id = cbshing_origins_lost_colony_event.42
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = default
		OR = {
			has_country_flag = colony_home_empire
			is_cbshing_lost_colony_events_country = yes
		}
		from = {
			is_country_type = default
			OR = {
				has_country_flag = colony_home_empire
				is_cbshing_lost_colony_events_country = yes
			}
		}
		is_same_species = FROM.owner_species
	}

	immediate = {
		if = { limit = { from = { has_country_flag = colony_home_empire } }
			country_event = { id = cbshing_origins_lost_colony_event.1 days = 10 }
		}
		if = { limit = { from = { is_cbshing_lost_colony_events_country = yes } }
			country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
		}
		from = {
			country_event = { id = cbshing_origins_lost_colony_event.3 days = 10 }
		}
	}
}