namespace = cbshing_origins_nuclear_start
# file modifies start planets to be a Tomb World Start
# by cbshing

# Triggers when the game starts
# assign custom start flag for custom start message
country_event = {
	id = cbshing_origins_nuclear_start.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				is_cbshing_nuclear_vault_country = yes
				AND = {
					is_cbshing_nuked_start_country = yes
					NOT = { has_authority = auth_machine_intelligence }
				}
			}
			set_country_flag = origins_restore_homeworld_needed				
		}
	}
}

### Change homeworld to Tombworld if have Nuclear Civics on Game Start
# change primary species to have tomb world preference if using Nuclear Mutation trait
country_event = {
	id = cbshing_origins_nuclear_start.2
	hide_window = yes
	is_triggered_only = yes

	trigger = { is_cbshing_nuclear_civics_country = yes }

	immediate = {
		random_owned_planet ={
			limit = { is_capital = yes }
			change_pc = pc_nuked
			reset_start_buildings_and_blockers_post_apoc = yes
			#planet_event = { id = cbshing_origins_nuclear_start.6 }
			planet_event = { id = cbshing_origins_nuclear_start.7 }
		}
		if = { 
			limit = { is_cbshing_nuclear_mutation_country = yes } 
			origins_give_species_tomb_world_preference = yes
		}
	}
}


# change secondary species to have tomb world preference
country_event = {
	id = cbshing_origins_nuclear_start.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = { 
		is_cbshing_nuclear_civics_country = yes 
		OR = {
			has_valid_civic = civic_syncretic_evolution
			has_valid_civic = civic_machine_servitor
			has_valid_civic = civic_machine_assimilator 
		}
	}

	immediate = {
		every_owned_pop = {
			limit = { 
				NOT = { is_same_species = owner_species } 
				is_sapient = yes 
			}
			modify_species = {
				species = this
				ideal_planet_class = pc_nuked
				base = none # makes this replace parent species
			}
			if = { limit = { owner = { has_valid_civic = civic_syncretic_evolution } }
				set_citizenship_type = {
					country = root.owner
					type = citizenship_slavery
				}
			}
			if = { limit = { owner = { has_valid_civic = civic_machine_servitor } }
				set_citizenship_type = {
					country = root.owner
					type = citizenship_limited
				}
				set_living_standard = {
					country = root.owner
					type = living_standard_organic_trophy
				}
			}
			if = { limit = { owner = { has_valid_civic = civic_machine_assimilator } }
				set_citizenship_type = {
					country = root.owner
					type = citizenship_full_machine
				}
				set_living_standard = {
					country = root.owner
					type = living_standard_hive_mind
				}
			}
		}
	}
}


# replace some buildings for vault start empires
# this: capital planet
# from: country
planet_event = {
	id = cbshing_origins_nuclear_start.6
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# Tombstart Vault for Vault Start instead of Science Lab
		if = { 
			limit = { owner = { is_cbshing_nuclear_vault_country = yes } }
			# Terminator Vault instead of Science Lab
			if = { limit = { owner = { has_government = gov_machine_terminator  } } 
				random_tile = {
					limit = { has_building = building_basic_science_lab_1 }
					remove_building = yes
					set_building = building_tombstart_vault_sd_terminator
				}
			}
			# Assimilator Vault instead of Science Lab
			if = { limit = { owner = { has_government = gov_machine_assimilator  } } 
				random_tile = {
					limit = { has_building = building_basic_science_lab_1 }
					remove_building = yes
					set_building = building_tombstart_vault_sd_assimilator
				}
			}
			# Machine Intelligence Vault instead of Science Lab
			if = { 
				limit = { 
					owner = { has_authority = auth_machine_intelligence }
					NOR = {
						owner = { has_government = gov_machine_terminator } 
						owner = { has_government = gov_machine_assimilator } 
						owner = { has_government = gov_machine_servitor } 
					}
				}
				random_tile = {
					limit = { has_building = building_basic_science_lab_1 }
					remove_building = yes
					set_building = building_tombstart_vault_sd_machine
				}
			}
			# Default Vault instead of Science Lab
			if = { limit = { NOT = { owner = { has_authority = auth_machine_intelligence } } }
				random_tile = {
					limit = { has_building = building_basic_science_lab_1 }
					remove_building = yes
					random_list = {
						25 = { set_building = building_tombstart_vault }
						15 = { set_building = building_tombstart_vault_a }
						15 = { set_building = building_tombstart_vault_b }
						15 = { set_building = building_tombstart_vault_c }
						15 = { set_building = building_tombstart_vault_d }
						15 = { set_building = building_tombstart_vault_e }
					}
				}
			}
		}			
	}
}

# replace farm buildings with energy buildings for machine empires
# this: capital planet
# from: country
planet_event = {
	id = cbshing_origins_nuclear_start.7
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { owner = { is_cbshing_nuclear_vault_country = yes } }
			# Machine Intelligence Has Power Plants instead of Farms
			if = { 
				limit = { 
					owner = { has_authority = auth_machine_intelligence }
				}
				every_tile = {
					limit = { has_building = building_hydroponics_farm_1 }
					remove_building = yes
					set_building = building_power_plant_1
				}
			}
		}			
	}
}